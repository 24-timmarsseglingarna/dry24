

.map-wrapper
  #map
  .outer-game-container
    .inner-game-container
      .game-box
        -#%p#notice= notice
        %h1= @crew.boat_name
        %p= 'Under tävling' unless @crew.finished
        Skeppare:
        = @crew.captain_name
        %br
        Start/mål:
        = @crew.start_point.number_name
        = image_tag "https://chart.googleapis.com/chart?chst=d_map_spin&chld=0.6|000000|ff8c00|8|_|#{@crew.start_point.number}"
        %br
        - unless @crew.finished
          Vid:
          = @crew.last_point.number_name
          = image_tag "https://chart.googleapis.com/chart?chst=d_map_spin&chld=0.6|000000|66ff66|8|_|#{@crew.last_point.number}"
          .instruments
            .instrument
              .legend#cog
                COG
              .value
                = '%.0f' % @crew.cog + '°'
            .instrument#sog
              .legend
                SOG
              .value
                = "#{@crew.sog}"
                %span.unit kt
            .instrument#vmg
              .legend
                VMG
              .value
                ***
                =# "#{@crew.vmg}"
                %span.unit kt
            .instrument#time
              .legend
                Time
              .value
                = "#{I18n.l @crew.game_time, :format => :long}"
            .instrument#wd
              .legend
                TWD
              .value
                = '%.0f' % @crew.twd + '°'
            .instrument#awa
              .legend
                AWA
              .value
                = '%.0f' % @crew.awa + '°'
            .instrument#aws
              .legend
                AWS
              .value
                = '%.1f' % @crew.aws
                %span.unit m/s
            .instrument
              .legend
                TWA
              .value
                = '%.0f' % @crew.twa + '°'
            .instrument
              .legend
                TWS
              .value
                = '%.1f' % @crew.tws
                %span.unit m/s
            .instrument
              .legend
                Trip
              .value
                ***
                =# '%.1f' % 0
                %span.unit M
            .instrument
              .legend
                Log
              .value
                ***
                =# '%.1f' % 0
                %span.unit M



          %h3
          %h3 Vart nu?
          %ol
          - if @crew.last_point == @crew.start_point && @crew.log_entries.count > 2
            %b Du är nu vid start-/målpunkten. Vill du gå i mål eller fortsätta segla?
            = link_to 'Gå i mål', finish_crew_path(@crew), :method => :put

          %p Gå till ...
          %ul
          -for section in @sections do
            %li= link_to (raw(section.to_point.number_name) + ' (' + section.distance.to_s + ' M)'), create_log_entry_crew_url(:to_point_id => section.to_point.id), :method => :post
        - else
          %p=link_to 'Börja om?', crews_path
      - sum = 0.0
      - for log_entry in @crew.log_entries do
        - sum += log_entry.distance.to_f
      %p= "Nettodistans: #{sum.round(1)} M."
      %h3 Loggbok
      %table.logbook
        %tr
          %th Tid
          %th Punkt
          %th Distans
          %th Vind
        - for log_entry in @crew.log_entries.reverse do
          %tr
            %td= I18n.l log_entry.to_time, :format => :long
            %td
              = log_entry.to_point.number_name unless log_entry.to_point.blank?
              = log_entry.description
            %td= log_entry.distance.to_s + " M"
            %td NV 3 m/s
      %p= "Torrsegling version: #{Rails.configuration.version}"

= render 'map'