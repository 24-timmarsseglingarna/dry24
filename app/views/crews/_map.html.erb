<script>
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {mapTypeId: google.maps.MapTypeId.TERRAIN,
            panControl: false,
            zoomControl: true,
            mapTypeControl: false,
            scaleControl: true,
            streetViewControl: false,
            overviewMapControl: true,
    },
        internal: {id: 'map'}}, function(){
        <%- for @polyline in @in_range do %>
        handler.addPolyline(<%=raw @polyline.to_json %>, { strokeColor: '#000000', strokeOpacity:0.2, strokeWeight:2});
        <%- end %>

        <%- for @polyline in @next_options do %>
            handler.addPolyline(<%=raw @polyline.to_json %>, { strokeColor: '#FF0000', strokeOpacity:1, strokeWeight:2});
        <%- end %>

        <%- for @polyline in @wakes do %>
            handler.addPolyline(<%=raw @polyline.to_json %>, { strokeColor: '#000066', strokeOpacity:0.4, strokeWeight:6});
        <%- end %>
        markers = handler.addMarkers(<%=raw @hash.to_json %>);
        handler.getMap().setZoom(10);
        <%- if @crew.finished %>
            handler.bounds.extendWith(markers);
            handler.fitMapToBounds();
        <%- else %>
            var centerpoint = new google.maps.LatLng(<%= raw @crew.last_point.latitude %>,<%= raw @crew.last_point.longitude %>);
            handler.getMap().setCenter(centerpoint);
        <%- end %>
    });
</script>